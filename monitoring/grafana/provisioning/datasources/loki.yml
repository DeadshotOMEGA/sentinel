apiVersion: 1

datasources:
  - name: Loki
    type: loki
    access: proxy
    url: http://loki:3100
    isDefault: false
    version: 1
    editable: true
    jsonData:
      maxLines: 1000
      derivedFields:
        # Correlation ID field - makes it clickable to see all related logs
        - name: CorrelationID
          matcherRegex: '"correlationId":"([^"]+)"'
          url: '/explore?left=["now-1h","now","Loki",{"expr":"{service=\"sentinel-backend\"} |= \"$${__value.raw}\""}]'
          datasourceUid: loki
        # User ID field - see all logs for a user
        - name: UserID
          matcherRegex: '"userId":"([^"]+)"'
          url: '/explore?left=["now-1h","now","Loki",{"expr":"{service=\"sentinel-backend\"} |= \"$${__value.raw}\""}]'
          datasourceUid: loki
